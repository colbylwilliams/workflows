name: Try Stuff

on:
  push:

jobs:
  init:
    name: Ensure GitHub Environments
    runs-on: ubuntu-latest

    steps:
      - name: Ensure GitHub Environments
        uses: actions/github-script@v6
        with:
          script: |
            const environments_result = await github.rest.repos.getAllEnvironments({
              owner: context.repo.owner,
              repo: context.repo.repo,
            });

            const environments = environments_result.data.environments;

            const names = ['Dev', 'Test', 'Pre-Prod', 'Prod', 'Boom'];

            for (let i = 0; i < names.length; i++) {
              const name = names[i];
              const exists = environments.some(e => e.name === name);
              if (!exists) {
                core.setFailed(`A GitHub environment named '${name}' does not exist.  Create an environment nammed '${name}'' and add a secret named 'AZURE_CREDENTIALS'`);
              }
            }
